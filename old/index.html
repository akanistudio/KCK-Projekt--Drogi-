<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
</head>

<body>
<button name=draw onclick="draw()">Rysuj</button>
<canvas id="map" width="500" height="500" style="border:1px solid #000000;"></canvas>
<script>

function draw()
{
  var newCoords = generateRoad(currX, currY);
  currX = newCoords.currentX;
  currY = newCoords.currentY;
}
var size = 500;
var tileSize = 100;
var direction = -1; // 0 - north, 1 - east, 2 - south, 3 - west
var drawn = 0;


var currX = Math.round(Math.random() * size);
var currY = Math.round(Math.random() * size);

var startX = currX;
var startY = currY;

var c=document.getElementById('map');
var ctx=c.getContext('2d');
for(i = 100; i < 500; i += 100)
{
  ctx.moveTo(0, i);
  ctx.lineTo(500,i);
  ctx.stroke();
  ctx.moveTo(i, 0);
  ctx.lineTo(i, 500);
  ctx.stroke();
}
ctx.beginPath();
ctx.moveTo(currX, currY);

ctx.strokeStyle = '#ff0000';

function random(a, b)
{
  return Math.round(Math.random() * Math.abs(b - a) + a);
}

function randomize3Direction(dir1, dir2, dir3)
{
  var randomize = Math.random();
  if(randomize < 0.33)
  {
    return dir1;
  }
  else if(randomize > 0.66)
  {
    return dir3;
  }
  else
  {
    return dir2;
  }
  
}
function randomize2Direction(dir1, dir2)
{
  var randomize = Math.random();
  if(randomize < 0.5)
  {
    return dir1;
  }
  else
  {
    return dir2;
  }
  
}

function generateRoad(currX, currY)
{
  if(drawn == 15)
  {
    draw.disabled = true;
    return undefined;
  }
  else
  {
    drawn ++;
    var idX = Math.floor(currX/tileSize);
    var idY = Math.floor(currY/tileSize);
    var newX;
    var newY;
    if(idX == 0)
    {
      if(idY == 0)
      {
        switch(direction)
        {
          case -1:
            direction = randomize2Direction(1, 2);
            break;
          case 3:
            direction = 2;
            break;
          case 0:
            direction = 1;
            break;
        }
      }
      else if(idY == size/tileSize - 1)
      {
        switch(direction)
        {
          case -1:
            direction = randomize2Direction(0, 1);
            break;
          case 2:
            direction = 1;
            break;
          case 3:
            direction = 0;
            break;
        }
      }
      else
      {
          switch(direction)
        {
          case -1:
            direction = randomize3Direction(0, 1, 2);
            break;
          case 0:
            direction = randomize2Direction(0, 1);
            break;
          case 2:
            direction = randomize2Direction(1, 2);
            break;
          case 3:
            direction = randomize2Direction(0, 2);
            break;
        }
      }
    }
    else if(idX == size/tileSize - 1)
    {
      if(idY == 0)
      {
        switch(direction)
        {
          case -1:
            direction = randomize2Direction(2, 3);
            break;
          case 0:
            direction = 3;
            break;
          case 1:
            direction = 2;
            break;
        }
      }
      else if(idY == size/tileSize - 1)
      {
          switch(direction)
        {
          case -1:
            direction = randomize2Direction(0, 3);
            break;
          case 2:
            direction = 3;
            break;
          case 1:
            direction = 0;
            break;
        }
      }
      else
      {
          switch(direction)
        {
          case -1:
            direction = randomize3Direction(0, 2, 3);
            break;
          case 0:
            direction = randomize2Direction(0, 3);
            break;
          case 1:
            direction = randomize2Direction(0, 2);
            break;
          case 2:
            direction = randomize2Direction(2, 3);
            break;
        }
      }
    }
    else if(idY == 0 && idX != size/tileSize - 1 && idX != 0)
    {
      switch(direction)
        {
          case -1:
            direction = randomize3Direction(1, 2, 3);
            break;
          case 0:
            direction = randomize2Direction(1, 3);
            break;
          case 1:
            direction = randomize2Direction(1, 2);
            break;
          case 3:
            direction = randomize2Direction(2, 3);
            break;
        }
    }
    else if(idY == size/tileSize - 1 && idX != size/tileSize - 1 && idX != 0)
    {
      switch(direction)
        {
          case -1:
            direction = randomize3Direction(0, 1, 3);
            break;
          case 1:
            direction = randomize2Direction(0, 1);
            break;
          case 2:
            direction = randomize2Direction(1, 3);
            break;
          case 3:
            direction = randomize2Direction(0, 3);
            break;
          
        }
    }
    else
    {
      if(direction == -1)
      {
        direction = random(0, 3);
      }
      else
      {
        switch(direction)
        {
          case 0:
            direction = randomize3Direction(0, 1, 3);
            break;
          case 1:
            direction = randomize3Direction(0, 1, 2);
            break;
          case 2:
            direction = randomize3Direction(1, 2, 3);
            break;
          case 3:
            direction = randomize3Direction(0, 2, 3);
            break;
        }
      }
    }
    
    if(direction == 0)
    {
      newY = idY * tileSize - 1;
      newX = random(40,60) + idX*tileSize;
    }
    else if(direction == 2)
    {
      newY = (idY+1) * tileSize + 1;
      newX = random(40,60) + idX*tileSize;
    }
    else if(direction == 1)
    {
      newY = random(40,60) + idY*tileSize; 
      newX = (idX+1) * tileSize + 1;
    }
    else if(direction == 3)
    {
      newY = random(40,60) + idY*tileSize; 
      newX = idX * tileSize - 1;
    }
  
    ctx.quadraticCurveTo(random(idX*100, (idX+1)*100), random(idY*100, (idY+1)*100), newX, newY);
    ctx.stroke();
    
    
    return {
          currentX: newX,
          currentY: newY
    };
  }
}

</script>

</body>
